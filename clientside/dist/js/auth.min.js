angular.module("authorization",["ngRoute","homunculus","homunculus.ui"]),angular.module("authorization").controller("AuthorizationController",["$log","$scope","$authorization","$window",function(e,a,o,i){a.email="",a.password="",a.submitted=!1,a.isLoading=!1,a.noUserFound=!1,a.login=function(){a.submitted=!0,a.noUserFound=!1,a.auth_form.$valid===!0&&o.login(a.email,a.password,function(e){e!==!1?i.location.reload():a.noUserFound=!0})}}]),angular.module("authorization").factory("$authorization",["$log","$http","$classes","$factory","$errors",function(e,a,o,i,u){o.add("AppUser",{id:new Field({source:"ID",type:DATA_TYPE_INTEGER,value:0,default_value:0}),divisionId:new Field({source:"DIVISION_ID",type:DATA_TYPE_INTEGER,value:0,default_value:0}),surname:new Field({source:"SURNAME",type:DATA_TYPE_STRING,value:"",default_value:""}),name:new Field({source:"NAME",type:DATA_TYPE_STRING,value:"",default_value:""}),fname:new Field({source:"FNAME",type:DATA_TYPE_STRING,value:"",default_value:""}),email:new Field({source:"EMAIL",type:DATA_TYPE_STRING,value:"",default_value:""}),password:new Field({source:"PASSWORD",type:DATA_TYPE_STRING,value:"",default_value:""}),isAdministrator:new Field({source:"IS_ADMINISTRATOR",type:DATA_TYPE_INTEGER,value:0,default_value:0}),allowEdit:new Field({source:"ALLOW_EDIT",type:DATA_TYPE_INTEGER,value:0,default_value:0}),allowConfirm:new Field({source:"ALLOW_CONFIRM",type:DATA_TYPE_INTEGER,value:0,default_value:0})});var t=i({classes:["AppUser","Model","Backup","States"],base_class:"AppUser"});return{init:function(){void 0!==window.initialData&&null!==window.initialData&&void 0!==window.initialData.user&&t._model_.fromJSON(window.initialData.user)},getCurrentUser:function(){return t},login:function(e,o,t){if(void 0===e)return u.add(ERROR_TYPE_DEFAULT,"$authorization -> login: Не задан параметр - логин пользователя"),!1;if(void 0===o)return u.add(ERROR_TYPE_DEFAULT,"$authorization -> login: Не задан параметр - пароль пользователя"),!1;var l={action:"login",data:{login:e,password:o}};a.post("/serverside/api.php",l).success(function(e){if(void 0!==e){if("false"!==e){var a=i({classes:["AppUser","Model","Backup","States"],base_class:"AppUser"});return a._model_.fromJSON(e),void 0!==t&&"function"==typeof t&&t(a),!0}return void 0!==t&&"function"==typeof t&&t(!1),!0}return!1})}}}]);